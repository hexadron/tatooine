/*
 Copyright (c) 2003-2012, CKSource - Frederico Knabben. All rights reserved.
 For licensing, see LICENSE.html or http://ckeditor.com/license
*/
(function(){function e(e){return CKEDITOR.env.ie?e.$.clientWidth:parseInt(e.getComputedStyle("width"),10)}function t(e,t){var n=e.getComputedStyle("border-"+t+"-width"),r={thin:"0px",medium:"1px",thick:"2px"};return 0>n.indexOf("px")&&(n=n in r&&"none"!=e.getComputedStyle("border-style")?r[n]:0),parseInt(n,10)}function n(e){var n=[],r=-1,i="rtl"==e.getComputedStyle("direction"),s;s=e.$.rows;for(var o=0,u,a,f,l=0,c=s.length;l<c;l++)f=s[l],u=f.cells.length,u>o&&(o=u,a=f);s=a,o=new CKEDITOR.dom.element(e.$.tBodies[0]),u=o.getDocumentPosition(),a=0;for(f=s.cells.length;a<f;a++){var l=new CKEDITOR.dom.element(s.cells[a]),c=s.cells[a+1]&&new CKEDITOR.dom.element(s.cells[a+1]),r=r+(l.$.colSpan||1),h,p,d=l.getDocumentPosition().x;i?p=d+t(l,"left"):h=d+l.$.offsetWidth-t(l,"right"),c?(d=c.getDocumentPosition().x,i?h=d+c.$.offsetWidth-t(c,"right"):p=d+t(c,"left")):(d=e.getDocumentPosition().x,i?h=d:p=d+e.$.offsetWidth),l=Math.max(p-h,3),n.push({table:e,index:r,x:h,y:u.y,width:l,height:o.$.offsetHeight,rtl:i})}return n}function r(e){(e.data||e).preventDefault()}function i(n){function i(){d=0,p.setOpacity(0),m&&s();var e=c.table;setTimeout(function(){e.removeCustomData("_cke_table_pillars")},0),h.removeListener("dragstart",r)}function s(){for(var n=c.rtl,r=n?y.length:g.length,i=0;i<r;i++){var s=g[i],u=y[i],a=c.table;CKEDITOR.tools.setTimeout(function(e,t,r,i,s,u){e&&e.setStyle("width",o(Math.max(t+u,0))),r&&r.setStyle("width",o(Math.max(i-u,0))),s&&a.setStyle("width",o(s+u*(n?-1:1)))},0,this,[s,s&&e(s),u,u&&e(u),(!s||!u)&&e(a)+t(a,"left")+t(a,"right"),m])}}function a(t){r(t);for(var t=c.index,n=CKEDITOR.tools.buildTableMap(c.table),i=[],s=[],o=Number.MAX_VALUE,u=o,a=c.rtl,E=0,S=n.length;E<S;E++){var T=n[E],N=T[t+(a?1:0)],T=T[t+(a?0:1)],N=N&&new CKEDITOR.dom.element(N),T=T&&new CKEDITOR.dom.element(T);if(!N||!T||!N.equals(T))N&&(o=Math.min(o,e(N))),T&&(u=Math.min(u,e(T))),i.push(N),s.push(T)}g=i,y=s,b=c.x-o,w=c.x+u,p.setOpacity(.5),v=parseInt(p.getStyle("left"),10),m=0,d=1,p.on("mousemove",l),h.on("dragstart",r),h.on("mouseup",f,this)}function f(e){e.removeListener(),i()}function l(e){E(e.data.$.clientX)}var c,h,p,d,v,m,g,y,b,w;h=n.document,p=CKEDITOR.dom.element.createFromHtml('<div data-cke-temp=1 contenteditable=false unselectable=on style="position:absolute;cursor:col-resize;filter:alpha(opacity=0);opacity:0;padding:0;background-color:#004;background-image:none;border:0px none;z-index:10"></div>',h),u||h.getDocumentElement().append(p),this.attachTo=function(e){d||(u&&(h.getBody().append(p),m=0),c=e,p.setStyles({width:o(e.width),height:o(e.height),left:o(e.x),top:o(e.y)}),u&&p.setOpacity(.25),p.on("mousedown",a,this),h.getBody().setStyle("cursor","col-resize"),p.show())};var E=this.move=function(e){if(!c)return 0;if(!d&&(e<c.x||e>c.x+c.width))return c=null,d=m=0,h.removeListener("mouseup",f),p.removeListener("mousedown",a),p.removeListener("mousemove",l),h.getBody().setStyle("cursor","auto"),u?p.remove():p.hide(),0;e-=Math.round(p.$.offsetWidth/2);if(d){if(e==b||e==w)return 1;e=Math.max(e,b),e=Math.min(e,w),m=e-v}return p.setStyle("left",o(e)),1}}function s(e){var t=e.data.getTarget();if("mouseout"==e.name){if(!t.is("table"))return;for(var n=new CKEDITOR.dom.element(e.data.$.relatedTarget||e.data.$.toElement);n&&n.$&&!n.equals(t)&&!n.is("body");)n=n.getParent();if(!n||n.equals(t))return}t.getAscendant("table",1).removeCustomData("_cke_table_pillars"),e.removeListener()}var o=CKEDITOR.tools.cssLength,u=CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks||7>CKEDITOR.env.version);CKEDITOR.plugins.add("tableresize",{init:function(e){e.on("contentDom",function(){var t;e.document.getBody().on("mousemove",function(o){o=o.data;if(t&&t.move(o.$.clientX))r(o);else{var u=o.getTarget(),f;if(u.is("table")||u.getAscendant("tbody",1)){f=u.getAscendant("table",1),(u=f.getCustomData("_cke_table_pillars"))||(f.setCustomData("_cke_table_pillars",u=n(f)),f.on("mouseout",s),f.on("mousedown",s));e:{o=o.$.clientX,f=0;for(var l=u.length;f<l;f++){var c=u[f];if(o>=c.x&&o<=c.x+c.width){u=c;break e}}u=null}u&&(!t&&(t=new i(e)),t.attachTo(u))}}})})}})})();