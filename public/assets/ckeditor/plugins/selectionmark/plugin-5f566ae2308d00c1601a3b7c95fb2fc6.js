/*
 Copyright (c) 2003-2012, CKSource - Frederico Knabben. All rights reserved.
 For licensing, see LICENSE.html or http://ckeditor.com/license
*/
(function(){function e(e){var t=e.editable();if(!t._.shadow){var e=e.getSelection().getRanges()[0].clone(),n=e.createBookmark2(),r=t.clone(1,1);r.setStyles({"z-index":-1,position:"absolute",left:t.$.offsetLeft+"px",top:t.$.offsetTop+"px",width:t.getSize("width",1)+"px",height:t.getSize("height",1)+"px"}),r.is("body")||r.setStyle("margin",0),r.addClass("cke-selection-shadow"),r.insertBefore(t),r.$.scrollTop=t.$.scrollTop,e.moveToBookmark(n),n=new CKEDITOR.style(CKEDITOR.tools.extend({attributes:{"data-cke-highlight":1},fullMatch:1,ignoreReadonly:1,childRule:function(){return 0}},{element:"var",styles:{"font-style":"normal","background-color":"#B0B0B0",color:"#fff"}},!0)),e.boundary=r,n.applyToRange(e),r.insertAfter(t),t.setOpacity(0),t._.shadow=r}}function t(e){delete r[e.name],CKEDITOR.tools.isEmpty(r)&&(clearTimeout(i),i=0),e=e.editable(),e._.shadow&&(e.setOpacity(1),e._.shadow.remove(),delete e._.shadow)}function n(n){r[n.name]="",i||function(){var n=arguments.callee;i=setTimeout(function(){for(var i in r){var s=CKEDITOR.instances[i],o=r[i],u;u=s.editable();for(var f="",l=0,c=["width","height"];l<c.length;l++)f+="|"+u.getSize(c[l]);u={html:u.getHtml(),size:f},o&&(u.html!=o.html?(t(s),e(s)):u.size!=o.size&&(s=s.editable(),o=s._.shadow,o.setStyles({"z-index":-1,position:"absolute",left:s.$.offsetLeft+"px",top:s.$.offsetTop+"px",width:s.getSize("width",1)+"px",height:s.getSize("height",1)+"px"}),o.$.scrollTop=s.$.scrollTop)),r[i]=u}n()},200)}()}if(CKEDITOR.env.ie&&8>CKEDITOR.env.version)CKEDITOR.plugins.add("selectionmark",function(){});else{var r={},i;CKEDITOR.plugins.add("selectionmark",{init:function(r){r.on("instanceReady",function(){var i=r.editable();if("absolute"!=i.getComputedStyle("position")&&!/^inline/.exec(i.getComputedStyle("display")))for(var s=["top","bottom"],o=0,u;u=s[o],2>o;o++){var f=parseInt(i.getComputedStyle("border-"+u+"-width"),10),l=parseInt(i.getComputedStyle("padding-"+u),10);!f&&!l&&(u="border-"+u,i.setStyle(u,"1px solid transparent"))}i.on("selectionchange",function(){i._.shadow&&(t(r),e(r))}),i.on("blur",function(){setTimeout(function(){if(r.focusManager.hasFocus){var t=r.getSelection();if(t&&t.isLocked){var t=r.getSelection(),i;if(i=t)t=t.getRanges(),i=1!=t.length||!t[0].collapsed;i&&(e(r),n(r))}}},200)}),i.on("focus",function(){t(r)})}),r.on("blur",function(){t(r)}),r.on("beforeDestroy",function(){t(r)})}})}})();